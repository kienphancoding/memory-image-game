// other themes to add ?
// bigger memory?

var library = {
  onepiece: [
    "https://i.pinimg.com/564x/1e/9d/a9/1e9da917d663b848e3c8cc58465c8d53.jpg",
    "https://i.pinimg.com/564x/71/17/5b/71175bf950d0d6a422bfdb2b38582163.jpg",
    "https://i.pinimg.com/564x/1f/20/1a/1f201a37df730a8d1b65d064e23c8b04.jpg",
    "https://i.pinimg.com/564x/86/6a/19/866a19a44aef78ef11d8015018ffb829.jpg",
    "https://i.pinimg.com/564x/dc/83/10/dc8310fe234de55beca4f655bc47eb18.jpg",
    "https://i.pinimg.com/564x/28/6c/f4/286cf4e8b8d2c477da5d16e3e6fbf543.jpg",
    "https://i.pinimg.com/564x/e1/35/ec/e135ecfc9e17ea634a53c8c5b5dba663.jpg",
    "https://i.pinimg.com/564x/8c/0c/e9/8c0ce9a2edc0eee3c50d86f47769a8c9.jpg",
    "https://i.pinimg.com/564x/32/ef/fc/32effc9f259773dd9ff9dd3c05db8d5d.jpg",
    "https://i.pinimg.com/736x/6b/88/e4/6b88e459f5c3ab91b850769b59ab9f37.jpg",
    "https://i.pinimg.com/564x/1e/9d/a9/1e9da917d663b848e3c8cc58465c8d53.jpg",
    "https://i.pinimg.com/564x/71/17/5b/71175bf950d0d6a422bfdb2b38582163.jpg",
    "https://i.pinimg.com/564x/1f/20/1a/1f201a37df730a8d1b65d064e23c8b04.jpg",
    "https://i.pinimg.com/564x/86/6a/19/866a19a44aef78ef11d8015018ffb829.jpg",
    "https://i.pinimg.com/564x/dc/83/10/dc8310fe234de55beca4f655bc47eb18.jpg",
    "https://i.pinimg.com/564x/28/6c/f4/286cf4e8b8d2c477da5d16e3e6fbf543.jpg",
    "https://i.pinimg.com/564x/e1/35/ec/e135ecfc9e17ea634a53c8c5b5dba663.jpg",
    "https://i.pinimg.com/564x/8c/0c/e9/8c0ce9a2edc0eee3c50d86f47769a8c9.jpg",
    "https://i.pinimg.com/564x/32/ef/fc/32effc9f259773dd9ff9dd3c05db8d5d.jpg",
    "https://i.pinimg.com/736x/6b/88/e4/6b88e459f5c3ab91b850769b59ab9f37.jpg",
  ],
  spyxfamily: [
    "https://i.pinimg.com/736x/7f/e7/9b/7fe79bc0a8d3c7c15381b786bf32a72a.jpg",
    "https://i.pinimg.com/564x/f9/1e/58/f91e58c27b25f0d6d0244d7a99de335e.jpg",
    "https://i.pinimg.com/564x/c9/74/6a/c9746af7d96c269edde675402a41523e.jpg",
    "https://i.pinimg.com/564x/80/68/41/806841ab5654f75eece455d1feec0165.jpg",
    "https://i.pinimg.com/564x/79/65/88/796588e36b48dc705770537617cd9922.jpg",
    "https://i.pinimg.com/564x/cb/19/6d/cb196d441ca94a33786eaaf49aed1826.jpg",
    "https://i.pinimg.com/564x/83/c2/c2/83c2c201b20ecf00fc5ea26e8e27a815.jpg",
    "https://i.pinimg.com/564x/05/f5/58/05f558f867b145588e3cb18c98156770.jpg",
    "https://i.pinimg.com/564x/23/12/7f/23127f157ab409b046137e6c621abc4f.jpg",
    "https://i.pinimg.com/564x/68/bc/08/68bc08b88101c934ca0f10fcf1793d68.jpg",
    "https://i.pinimg.com/736x/7f/e7/9b/7fe79bc0a8d3c7c15381b786bf32a72a.jpg",
    "https://i.pinimg.com/564x/f9/1e/58/f91e58c27b25f0d6d0244d7a99de335e.jpg",
    "https://i.pinimg.com/564x/c9/74/6a/c9746af7d96c269edde675402a41523e.jpg",
    "https://i.pinimg.com/564x/80/68/41/806841ab5654f75eece455d1feec0165.jpg",
    "https://i.pinimg.com/564x/79/65/88/796588e36b48dc705770537617cd9922.jpg",
    "https://i.pinimg.com/564x/cb/19/6d/cb196d441ca94a33786eaaf49aed1826.jpg",
    "https://i.pinimg.com/564x/83/c2/c2/83c2c201b20ecf00fc5ea26e8e27a815.jpg",
    "https://i.pinimg.com/564x/05/f5/58/05f558f867b145588e3cb18c98156770.jpg",
    "https://i.pinimg.com/564x/23/12/7f/23127f157ab409b046137e6c621abc4f.jpg",
    "https://i.pinimg.com/564x/68/bc/08/68bc08b88101c934ca0f10fcf1793d68.jpg",
  ],
  lotr: [
    "https://res.cloudinary.com/beumsk/image/upload/v1547981408/memory/lotr/gandalf.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981438/memory/lotr/sauron.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981469/memory/lotr/Aragorn.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981501/memory/lotr/legolas.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981535/memory/lotr/Gimli.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981603/memory/lotr/golum.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981645/memory/lotr/sam.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981686/memory/lotr/saroumane.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981738/memory/lotr/bilbo.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981802/memory/lotr/frodo.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981408/memory/lotr/gandalf.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981438/memory/lotr/sauron.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981469/memory/lotr/Aragorn.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981501/memory/lotr/legolas.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981535/memory/lotr/Gimli.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981603/memory/lotr/golum.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981645/memory/lotr/sam.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981686/memory/lotr/saroumane.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981738/memory/lotr/bilbo.jpg",
    "https://res.cloudinary.com/beumsk/image/upload/v1547981802/memory/lotr/frodo.jpg",
  ],
};

var images = [];
var tempElt1 = "";
var tempElt2 = "";
var click = -1;
var win = 0;
var score = 0;
var time = 0;

var preElt = document.querySelector("#pre");
var themesElt = document.querySelector("#themes");
var boxElts = document.getElementsByClassName("box");
var mainElt = document.querySelector(".main");
var timeElt = document.querySelector("#time");
var scoreElt = document.querySelector("#score");
var postElt = document.querySelector("#post");
var finalElt = document.querySelector("#final");
var againElt = document.querySelector("#again");

// initiate the game with chosen theme
themesElt.addEventListener("click", function (e) {
  if (e.target.classList.contains("themes")) {
    activateTheme(e.target.id);
    preElt.classList.add("hidden");
  }
});

function activateTheme(theme) {
  // insert theme in images array
  for (let i = 0; i < 20; i++) {
    images.push(library[theme][i]);
  }
  // insert images in memory game
  for (let i = 0; i < 20; i++) {
    var rand = Math.floor(Math.random() * (images.length - 1));
    boxElts[i].innerHTML =
      "<img src='" + images[rand] + "' alt='image' class='hidden'>";
    images.splice(rand, 1);
  }
}

// Handle the play
mainElt.addEventListener("click", gameLogic);

function gameLogic(e) {
  // make sure the box is playable
  if (e.target.classList.contains("play")) {
    e.target.firstChild.classList.remove("hidden");
    // first of two click
    if (click < 1) {
      tempElt1 = e.target;
      // timer
      if (click === -1) {
        timer = setInterval(function () {
          time++;
          timeElt.innerHTML = time;
        }, 1000);
      }
      click = 1;
    }

    // second click
    else if (e.target !== tempElt1) {
      tempElt2 = e.target;

      // different images
      if (tempElt1.firstChild.src !== tempElt2.firstChild.src) {
        mainElt.removeEventListener("click", gameLogic);
        setTimeout(function () {
          tempElt1.firstChild.classList.add("hidden");
          tempElt2.firstChild.classList.add("hidden");
          mainElt.addEventListener("click", gameLogic);
        }, 400);
        if (score > 0) {
          score -= 2;
        }
        scoreElt.innerHTML = score;
      }

      // same images
      else {
        score += 10;
        win += 2;
        tempElt1.firstChild.classList.add("outlined");
        tempElt2.firstChild.classList.add("outlined");
        tempElt1.classList.remove("play");
        tempElt2.classList.remove("play");
        scoreElt.innerHTML = score;

        // game won
        if (win === 20) {
          clearInterval(timer);
          finalElt.innerHTML =
            "You won " + score + " points <br> in " + time + " seconds";
          postElt.classList.remove("hidden");
        }
      }
      click = 0;
    }
  }
}

againElt.addEventListener("click", resetGame);

function resetGame() {
  // reset game
  tempElt1 = "";
  tempElt2 = "";
  click = -1;
  win = 0;
  score = 0;
  time = 0;
  postElt.classList.add("hidden");
  preElt.classList.remove("hidden");
  for (let i = 0; i < 20; i++) {
    boxElts[i].classList.add("play");
    boxElts[i].firstChild.classList.add("hidden");
  }
  timeElt.textContent = time;
  scoreElt.textContent = score;
}

// handle focus of the page
// function checkPageFocus() {
//   if (document.hasFocus()) {
//     preElt.classList.remove("hidden");
//   }
//   else {
//     preElt.classList.add("hidden");
//   }
// }
// var checkPageInterval = setInterval(checkPageFocus, 300);
